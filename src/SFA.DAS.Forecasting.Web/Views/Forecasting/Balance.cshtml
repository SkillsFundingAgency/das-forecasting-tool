@using SFA.DAS.Forecasting.Web.Extensions
@model SFA.DAS.Forecasting.Web.ViewModels.BalanceViewModel

@{
    ViewBag.Title = "Funding projection";
}


<div class="grid-row funding-projection">
    <div class="column-two-thirds">
        <div class="hgroup form-group">
            <h1 class="heading-xlarge">
                Funding projection
            </h1>
            <p>
                The figures below show the estimated funds that may be available to you for the duration of your apprenticeships.
            </p>

            <details>
                <summary>More information</summary>
                <div class="">
                    <p>
                        The figures below show the estimated funds that may be available to you for the duration of your apprenticeships.
                    </p>
                    <p>
                        These figures are based on the current information in your account and the data provided by your training provider which is used to calculate funding.
                    <p />
                    <p>
                        The projection doesn’t include any future apprenticeship starts or apprentices who’ve already started and payment has not yet been made to their training provider.
                    </p>
                    <p>
                        You can estimate how many apprenticeships you could fund in the future - either by transferring any remaining funds to another employer or by taking on more apprentices yourself.
                    </p>
                </div>
            </details>
        </div>
    </div>

    <div class="column-one-third">
        <div class="related">
            <h3 class="heading-small">Download data as a CSV file</h3>
            <div class="form-group">
                <ul class="list list-links">

                    <li>
                        <a id="apprenticeship_csvdownload" href="@Url.Action("DownloadApprenticeshipDetailsCsv", "Forecasting", new { hashedAccountId = Model.HashedAccountId }, null)" class="">
                            Apprenticeship details in the account projection
                        </a>
                        <p>
                            The download includes the details of apprenticeships used to create this projection
                        </p>
                    </li>

                    <li>
                        <a id="projections_csvdownload" href="@Url.Action("Csv", "Forecasting", new { hashedAccountId = Model.HashedAccountId }, null)" class="">
                            Account projection table
                        </a>
                        <p>
                            The download includes the details of the data in the table shown on this page
                        </p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- CHART -->
<div class="grid-row">
    <div class="column-full">
        <div class="chart-container">
            <div class="chart-data"
                 data-dates="@Model.DatesStringArray"
                 data-values="@Model.BalanceStringArray">

            </div>
            <h2 class="heading-large">Funding Projection Chart</h2>
            <p>Account funds over time</p>
            <div id="chart"></div>
        </div>
    </div>
</div>

<!-- Projection -->
<h4 class="heading-large">Your account projection</h4>
<div class="grid-row" id="account-projection">
    <div class="column-two-thirds">
        <p>A month by month projection of your account balance.</p>
        <p>
            <span class="bold">Current Balance: </span> @Model.CurrentBalance.FormatCost()
        </p>
    </div>
    <div class="column-one-third pending-completion-payments">
        <div class="panel panel-width-thin">
            <p>Overdue completion payments</p>
            <span class="heading-medium">@Model.OverdueCompletionPayments.FormatCost()</span>
            <details>
                <summary>What does this figure mean?</summary>
                <div class="">
                    <p>This is the value of your overdue completion payments where the apprenticeships have overrun the planned completion date.</p>
                </div>
            </details>
        </div>
    </div>
</div>

<div class="grid-row">
    <div class="column-full">

        @foreach (var x in Model.ProjectionTables)
        {
            <h3 class="heading-medium">@x.Key.FirstStartDate.ToGdsFormatWithoutDay() to @x.Key.LastEndDate.ToGdsFormatWithoutDay()</h3>
            @:<table class="small balancesheet">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        @if (Model.DisplayCoInvestment)
                        {
                            <th colspan="2" class="co-invest-head grey-bg">Co-investment</th>
                        }
                        <th></th>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <th class="financial">Cost of training</th>
                        <th class="financial">Completion payments</th>
                        <th class="financial">Expired funds </th>
                        <th class="financial">Funds in</th>
                        @if (Model.DisplayCoInvestment)
                        {
                            <th class="financial grey-bg">Your contribution (10%)</th>
                            <th class="financial grey-bg">Government contribution (90%)</th>
                        }
                        <th class="financial">Balance</th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in x.Value)
                    {
                        <tr>
                            <td>@item.Date.ToGdsFormatShortMonthWithoutDay()</td>
                            <td class="financial">@item.CostOfTraining.FormatCost()</td>
                            <td class="financial">@item.CompletionPayments.FormatCost()</td>
                            <td class="financial">
                                <span>–</span>
                            </td>
                            <td class="financial">@item.FundsIn.FormatCost()</td>
                            @if (Model.DisplayCoInvestment)
                            {
                                <td class="financial grey-bg">
                                    @if (item.CoInvestmentEmployer == 0)
                                    {
                                        <span>–</span>
                                    }
                                    else
                                    {
                                        <span>@item.CoInvestmentEmployer.FormatCost()</span>
                                    }
                                </td>
                                <td class="financial grey-bg">
                                    @if (item.CoInvestmentGovernment == 0)
                                    {
                                        <span>–</span>
                                    }
                                    else
                                    {
                                        <span>@item.CoInvestmentGovernment.FormatCost()</span>
                                    }
                                </td>
                            }
                            <td class="financial">@item.Balance.FormatCost()</td>
                        </tr>
                    }
                </tbody>
            @:</table>
        }

        <details>
            <summary>Where is the end-point assessment cost?</summary>
            <div class="panel panel-width-thin">

                <p>The end-point assessment cost is paid by your training provider at the end of the apprenticeship.  The funds for this payment are included in the training and completion costs.</p>
                <p>
                    This payment will be made to the end point assessment organisation by the training provider at the end of the apprenticeship or soon after the apprenticeship has finished.

                </p>
            </div>
        </details>

    </div>
</div>
<div class="grid-row">
    <div class="column-full">
        <div class="info-summary">
            <h3 class="heading-medium">Disclaimer</h3>
            <p>This tool is designed to illustrate what your funds may look like based on the apprenticeships currently in your apprenticeship service account.</p>
            <p>The actual amount of funds available is likely to vary if there are any changes made to your apprenticeship arrangements, including, for example, changes in the number of apprentices employed, or the cost and duration of their training.</p>
            <p>You should therefore not rely solely on the information provided by this tool when making decisions about how to spend future levy funds.</p>
        </div>
    </div>

</div>

@section breadcrumb {
    @if (!string.IsNullOrEmpty(Model.BackLink))
    {
        <div class="breadcrumbs">
            <a href="@Model.BackLink" aria-label="Back" class="back-link">Back</a>
        </div>
    }
}
